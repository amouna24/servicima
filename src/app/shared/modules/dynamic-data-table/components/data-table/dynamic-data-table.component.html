<div class="dynamic-component-container border-radius-20" fxLayout="column" fxFlex="100" >
  <div fxLayout="row" fxFlex="14" fxLayoutAlign="space-around center">
    <div fxLayout="column" fxFlex="56">
      <h1 class="steel font-size-24 font-medium" >{{ header.title }}</h1>
    </div>
    <div fxLayout="column" fxFlex="15" fxLayoutAlign="center end" class="font-size-25 steel">
      <button *ngIf="buttonAdd !== false" mat-raised-button  class="btn-medium bg-cerulean-blue" (click)="redirectToPageOrDialog(header.type)">
        <mat-icon class="icon material-icons-outlined"  svgIcon="wi_add_user">
        </mat-icon>
        &nbsp;
        <span   class="white font-size-12 font-normal">{{ header.addActionText | spliceText: 20  }}</span>
      </button>
    </div>
  </div>
  <div fxLayout="row" fxFlex="1" fxLayoutAlign="space-around center">
    <mat-divider [ngStyle]="{ 'width': '90%', borderTopWidth: '2px' }"></mat-divider>
  </div>
  <div fxLayout="row" fxFlex="14" fxLayoutAlign="space-between center">
    <div fxLayout="row" fxFlex="55" fxLayoutAlign="space-around center">
      <div fxLayout="row" fxFlex="80" fxLayoutGap="20px" class="m-t-10">
        <mat-form-field class="data-table-search-bar" [style]="{'width': '80%', 'height': '80%', 'fontSize': '5px'}" appearance="outline">
          <input matInput type="search" placeholder="Search ..." class="font-extra-light font-size-12">
          <span matPrefix class="absolute mat-icon-btn"><img src="assets/icons/Iconly_Light_Search.svg"></span>
        </mat-form-field>
        <button mat-stroked-button  [style]="{'width': '10%', 'height': '80%'}" (click)="displayTableConfig()">
          <mat-icon svgIcon="wi_adjustments" class="icon material-icons-outlined steel"></mat-icon>
        </button>
        <button mat-stroked-button  [style]="{'width': '10%', 'height': '80%'}" >
          <mat-icon svgIcon="wi_filter" class="icon material-icons-outlined steel"></mat-icon>
        </button>
        <button mat-stroked-button  [style]="{'width': '10%', 'height': '80%'}">
          <span class="cool-grey">Run</span>
        </button>
        <button mat-stroked-button  [style]="{'width': '10%', 'height': '80%'}" >
          <span class="cool-grey">Save</span>
        </button>
      </div>
    </div>
    <div fxLayout="row" fxFlex="30" fxLayoutGap="2%"  fxLayoutAlign="center center">
      <div fxLayout="row">
        <button  mat-raised-button class="btn-medium bg-topaz overwrite-btn-medium">
          <span class="white font-size-11">Export</span>
        </button>
      </div>
      <div fxLayout="row">
        <mat-accordion class="mat-accordion-action bg-topaz" #accordion="matAccordion"  [ngClass]="{
    'accordion-list':panelOpenState === true,
    'accordion-btn':panelOpenState === false
  }">

          <mat-expansion-panel (click)="open($event)" [ngClass]="{
    'mat-expansion-panel-header-list':panelOpenState === true,
    'mat-expansion-panel-header-btn':panelOpenState === false
  }" (opened)="panelOpenState = true"
                               (closed)="panelOpenState = false" class="bg-topaz">
            <mat-expansion-panel-header >
              <mat-panel-title  >
                <span class="white font-size-11">Actions</span>
              </mat-panel-title>



            </mat-expansion-panel-header>
            <div class="white cursor-pointer font-size-11" (click)="actionRowData(book, listChecked)"  *ngFor="let book of allowedActions"> <hr class="white" [style]="{'height': '1px','border': '1px solid' }"> {{ book }}
            </div>
          </mat-expansion-panel>


        </mat-accordion>
      </div>
    </div>
  </div>
  <div fxLayout="row" fxFlex="64" fxLayoutAlign="space-around">

    <wid-scrollbar class="dynamic-data-table-content" style="width: 100%" >

      <ng-container *ngIf="dataSource?.length === 0 && isLoading.getValue() === false" >
        <div fxFlex="100" fxLayout="row" fxLayoutAlign="center start">
          <div fxFlex="90" fxLayout="column" fxLayoutAlign="center center" [style]="{border: 'solid 3px #e8f1f9', borderRadius: '15px', height: '50%'}">
            <div  fxFlex="15" fxLayout="row">
              <span class="cool-grey font-size-18">No Data Found</span>
            </div>
            <div  fxFlex="15" fxLayout="row">
              <div *ngIf="buttonAdd !== false">
                <button  mat-raised-button  class="btn-medium bg-cerulean-blue" (click)="redirectToPageOrDialog(header.type)">
                  <span class="white font-size-12 font-normal">{{ header.addActionText | spliceText: 20  }}</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container  *ngIf="isLoading.getValue() === false && dataSource?.length > 0" >
        <table BORDER=0 CELLSPACING=0 cdk-table [style]="{'width': '100%', 'height': 'min-content'}" [dataSource]="dataSource" [trackBy]="identify" @dataAppearance>

          <ng-container *ngFor="let col of columns;" >

            <ng-container [ngSwitch]="col.type">

              <ng-container *ngSwitchCase="'rowItem'">

                <ng-container cdkColumnDef="{{ col.prop }}" [sticky]="true">
                  <th cdk-header-cell *cdkHeaderCellDef class="steel font-size-14 font-semi-bold">
                    <mat-checkbox color="accent" (change)="selectAll($event)" [(ngModel)]="selectedAll"  color="accent"  [indeterminate]="isIndeterminate()"  class="example-margin checkbox-width" fxFlex="100" fxLayoutAlign="center">
                    </mat-checkbox>
                  </th>
                  <td  cdk-cell *cdkCellDef="let row" class="black-three font-size-12 font-light" >
                    <mat-checkbox  (change)="getChecked(row,$event)"  [ngModel]="row['checked']"  class="example-margin checkbox-width" color="accent" >
                    </mat-checkbox>
                  </td>

                </ng-container>

              </ng-container>

              <ng-container *ngSwitchDefault >

                <ng-container cdkColumnDef="{{ col.prop }}">
                  <th cdk-header-cell
                      *cdkHeaderCellDef class="steel font-size-14 font-semi-bold"> {{ col.name }}
                  </th>
                  <ng-container [ngSwitch]="col.type">
                    <ng-container *ngSwitchCase="'image'">

                      <td (click)="actionRowData('update', row)"  cdk-cell *cdkCellDef="let row" class="black-three font-size-12 font-light">

                        <img [src]=  "row[col.prop] ? env + row[col.prop] : 'assets/img/default.jpg'" alt=""  [style]=" {'height':'40px', 'width':'45px','border-radius': '50%'}">
                      </td>
                    </ng-container>

                    <ng-container *ngSwitchCase="'date'">
                      <td cdk-cell (click)="actionRowData('update', row)"
                          *cdkCellDef="let row" class="black-three font-size-12 font-light"> {{ row[col.prop] | date:'short' }}
                      </td>
                    </ng-container>
                    <ng-container *ngSwitchDefault>
                      <td cdk-cell (click)="actionRowData('update', row)"
                          *cdkCellDef="let row" class="black-three font-size-12 font-light" >
                        <div (mouseover)="showAllText=true"  (mouseout)="showAllText=false">
                          <ng-container *ngIf="row[col.prop] === null; else propNotNull">
                            <span></span>
                          </ng-container>
                          <ng-template #propNotNull>
                          <ng-container *ngIf="row[col.prop]['cellColor']; else noColor">
                                <span *ngIf="showAllText"
                                      matTooltip="{{row[col.prop]['value']}}" [ngStyle]="{ 'color' : row[col.prop]['cellColor']}" >
                           {{ row[col.prop]['value'] | spliceText: 40 }}
                          </span>
                            <span *ngIf="!showAllText" [ngStyle]="{ 'color' : row[col.prop]['cellColor']}">
                            {{ row[col.prop]['value'] | spliceText: 40 }}
                          </span>
                          </ng-container>
                          <ng-template #noColor>
                                <span *ngIf="showAllText"
                                      matTooltip="{{row[col.prop]}}"  >
                           {{ row[col.prop] | spliceText: 40 }}
                          </span>
                            <span *ngIf="!showAllText" >
                            {{ row[col.prop] | spliceText: 40 }}
                          </span>
                          </ng-template>
                          </ng-template>
                        </div>
                      </td>
                    </ng-container>
                  </ng-container>
                </ng-container>

              </ng-container>

            </ng-container>

          </ng-container>

          <tr cdk-header-row *cdkHeaderRowDef="columnsList; sticky: true"></tr>
          <tr [style.background]="row['color']" cdk-row *cdkRowDef="let row; columns: columnsList;"></tr>

        </table>
      </ng-container>

      <ng-container *ngIf="isLoading.getValue();" >
        <div fxFlex="100" fxLayoutAlign="center center">
          <mat-progress-spinner
            color="primary"
            mode="indeterminate">
          </mat-progress-spinner>
        </div>
      </ng-container>


    </wid-scrollbar>

  </div>
  <div class="data-table-pagination" fxLayout="row" fxFlex="7" fxLayoutAlign="space-between">
    <div fxLayout="column" fxFlex="25" fxLayoutAlign="center">
      <div fxLayout="row" fxLayoutAlign="space-around center">

        <span fxLayoutAlign="center center" class="black-three font-size-12">
          {{ offset }} - {{ totalCountedItems || countedItems }} of {{ totalItems }}
        </span>

        <button
          mat-stroked-button
          fxLayoutAlign="center center" class="next-previous-page bg-white-two black-three font-size-12"
          [disabled] = "offset <= limit"
          (click)="getItemsPerPage('first-page')"
        >
          <span class="material-icons-outlined font-size-16">first_page</span>
        </button>
        <button
          mat-stroked-button
          fxLayoutAlign="center center" class="next-previous-page bg-white-two black-three font-size-12"
          [disabled] = "offset <= limit"
          (click)="getItemsPerPage('previous-page')"
        >
          <span class="material-icons-outlined font-size-16">navigate_before</span>
        </button>

        <ng-container *ngFor="let pageNumber of nbrPages">
          <button
            mat-stroked-button
            fxLayoutAlign="center center" class="next-previous-page font-size-12"
            [ngClass] = "pageNumber === currentPage ? 'bg-topaz white'
                                                  : 'bg-white-two black-three'"
            (click)="getItemsPerPage('specific-page', pageNumber)"
          >
            <span>{{ pageNumber }}</span>
          </button>
        </ng-container>

        <button
          mat-stroked-button
          fxLayoutAlign="center center" class="next-previous-page bg-white-two black-three font-size-12"
          [disabled] = "(totalCountedItems || countedItems) >= totalItems"
          (click)="getItemsPerPage('next-page')"
        >

          <span class="material-icons-outlined font-size-16">navigate_next</span>
        </button>
        <button
          mat-stroked-button
          fxLayoutAlign="center center" class="next-previous-page bg-white-two black-three font-size-12"
          [disabled] = "(totalCountedItems || countedItems) >= totalItems"
          (click)="getItemsPerPage('last-page')"
        >
          <span class="material-icons-outlined font-size-16">last_page</span>
        </button>

      </div>

    </div>
    <div fxLayout="column" fxFlex="20">
      <div fxLayout="row" fxFlex="100" fxLayoutAlign="center center">
        <div fxLayout="column" fxFlex="100px" fxLayoutAlign="center center">
          <mat-label class="black font-size-10" >
            Items per page:
          </mat-label>
        </div>
        <div fxLayout="column" fxFlex="50px" fxLayoutAlign="center center">
          <mat-form-field class="mat-form-field-no-padding font-size-10" appearance="outline">
            <mat-select disableOptionCentering [formControl]="itemsPerPageControl">
              <mat-option *ngFor="let v of itemsPerPage" [value]="v">
                {{v}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>


      </div>

    </div>
  </div>
</div>
